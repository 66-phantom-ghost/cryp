<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini-Messenger</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #chat { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; }
  input, button { padding: 5px; margin: 5px 0; }
</style>
</head>
<body>
<h2>Mini-Messenger</h2>

<label>Deine ID:</label><br>
<input type="text" id="myId" placeholder="z. B. alice"><br>

<label>Empfänger ID:</label><br>
<input type="text" id="peerId" placeholder="z. B. bob"><br>

<button id="connectBtn">Verbinden</button>

<div id="chat"></div>

<input type="text" id="msgInput" placeholder="Nachricht..." disabled>
<button id="sendBtn" disabled>Senden</button>

<script>
let ws;

const chatBox = document.getElementById("chat");
const msgInput = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");
const connectBtn = document.getElementById("connectBtn");

connectBtn.onclick = () => {
    const myId = document.getElementById("myId").value.trim();
    const peerId = document.getElementById("peerId").value.trim();

    if (!myId || !peerId) {
        alert("Bitte beide IDs eingeben!");
        return;
    }

    // Verbindung zum WebSocket-Server über Ngrok-Link
    ws = new WebSocket(`wss://unwintry-strapping-winford.ngrok-free.dev/ws?id=${myId}`);

    ws.onopen = () => {
        chatBox.innerHTML += `<div><em>Verbunden als ${myId}</em></div>`;
        msgInput.disabled = false;
        sendBtn.disabled = false;
    };

    ws.onmessage = (event) => {
        try {
            const data = JSON.parse(event.data);
            if (data.from && data.message) {
                chatBox.innerHTML += `<div><strong>${data.from}:</strong> ${data.message}</div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        } catch (err) { console.error(err); }
    };

    ws.onerror = (err) => {
        chatBox.innerHTML += `<div style="color:red;"><em>Fehler: ${err.message}</em></div>`;
    };

    sendBtn.onclick = () => {
        const message = msgInput.value.trim();
        if (message) {
            ws.send(JSON.stringify({ to: peerId, message }));
            chatBox.innerHTML += `<div><strong>Du:</strong> ${message}</div>`;
            msgInput.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    };
};
</script>
</body>
</html>
