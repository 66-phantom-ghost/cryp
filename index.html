<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cyber Encryption Gateway</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        font-family: 'Fira Code', monospace;
        background-color: #0a0a0a;
        color: #ff3c3c;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 700px;
        margin: 2rem auto;
        padding: 2rem;
        background: #111;
        border: 1px solid #ff3c3c;
        border-radius: 10px;
        box-shadow: 0 0 20px #ff3c3c33;
    }
    input, textarea, button {
        font-family: inherit;
    }
    input, textarea {
        width: 100%;
        padding: 0.75rem;
        margin: 0.5rem 0;
        background: #1a1a1a;
        border: 1px solid #ff3c3c;
        border-radius: 5px;
        color: #fff;
    }
    button {
        background: #ff3c3c;
        color: #0a0a0a;
        padding: 0.75rem;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.2s;
    }
    button:hover {
        background: #ff0000;
        box-shadow: 0 0 10px #ff0000aa;
    }
    .output {
        background: #1a1a1a;
        border: 1px dashed #ff3c3c;
        padding: 1rem;
        margin-top: 1rem;
        word-break: break-all;
        position: relative;
    }
    .copy-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: #ff3c3c;
        color: #0a0a0a;
        border: none;
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
        cursor: pointer;
        border-radius: 3px;
    }
</style>
</head>
<body>
<div class="container">
    <h1 class="text-3xl font-bold text-center mb-4">Cyber Encryption Gateway</h1>

    <label for="text-input">Text eingeben:</label>
    <textarea id="text-input" rows="4" placeholder="Hier Text zum Verschlüsseln oder Entschlüsseln einfügen..."></textarea>

    <label for="password-input">Passwort:</label>
    <input type="password" id="password-input" placeholder="Haupt-Passwort">

    <label for="secondary1">Zusatz 1 (optional):</label>
    <input type="password" id="secondary1" placeholder="Zusatz-Passwort 1">

    <label for="secondary2">Zusatz 2 (optional):</label>
    <input type="password" id="secondary2" placeholder="Zusatz-Passwort 2">

    <label for="secondary3">Zusatz 3 (optional):</label>
    <input type="password" id="secondary3" placeholder="Zusatz-Passwort 3">

    <div class="flex justify-between mt-4">
        <button onclick="encrypt()">Verschlüsseln</button>
        <button onclick="decrypt()">Entschlüsseln</button>
    </div>

    <div class="output" id="output">
        <button class="copy-btn" onclick="copyOutput()">Copy</button>
        <pre id="output-text">Ergebnis erscheint hier...</pre>
    </div>
</div>

<script>
const API = "https://unwintry-strapping-winford.ngrok-free.dev/api/approve";
const TOKEN = "9f3c8a1d4e2b7a6c8f1e9d0a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b";

async function sha256(str) {
    const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

async function getServerApproval(clientHash) {
    const res = await fetch(API, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-API-Token': TOKEN
        },
        body: JSON.stringify({ clientHash })
    });
    return res.json();
}

async function encrypt() {
    const text = document.getElementById('text-input').value;
    const pass = document.getElementById('password-input').value;
    const sec = [
        document.getElementById('secondary1').value,
        document.getElementById('secondary2').value,
        document.getElementById('secondary3').value
    ].filter(v=>v);
    if(!text||!pass){ alert('Text und Passwort benötigt'); return; }

    const combined = pass + sec.join('|') + text;
    const clientHash = await sha256(combined);

    const response = await getServerApproval(clientHash);
    if(!response.ok){ document.getElementById('output-text').textContent='Server verweigert'; return; }

    const finalKey = await sha256(clientHash + response.approval);
    document.getElementById('output-text').textContent = finalKey;
}

async function decrypt() {
    const text = document.getElementById('text-input').value;
    const pass = document.getElementById('password-input').value;
    const sec = [
        document.getElementById('secondary1').value,
        document.getElementById('secondary2').value,
        document.getElementById('secondary3').value
    ].filter(v=>v);
    if(!text||!pass){ alert('Text und Passwort benötigt'); return; }

    const combined = pass + sec.join('|') + text;
    const clientHash = await sha256(combined);

    const response = await getServerApproval(clientHash);
    if(!response.ok){ document.getElementById('output-text').textContent='Entschlüsselung nur mit Server-Freigabe möglich'; return; }

    const finalKey = await sha256(clientHash + response.approval);
    document.getElementById('output-text').textContent = finalKey;
}

function copyOutput() {
    const text = document.getElementById('output-text').textContent;
    navigator.clipboard.writeText(text);
    alert('Ergebnis kopiert!');
}
</script>
</body>
</html>
