<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ngrok Gateway Test Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');
        .terminal-font { font-family: 'Fira Code', monospace; }
    </style>
</head>
<body class="bg-gray-900 text-lime-400 p-8 min-h-screen">

    <div class="max-w-xl mx-auto bg-gray-800 p-6 rounded-lg shadow-xl border border-lime-600/50">
        <h1 class="text-2xl font-bold border-b border-lime-600 pb-2 mb-4 text-white">Gateway Test-Client</h1>
        <p class="mb-4 text-sm">Dieser Client sendet eine **GET**-Anfrage an Ihr Krypto-Gateway (über Ngrok) und prüft den API-Token. Der Backend-Server (`server.js`) akzeptiert für diesen Endpunkt nur GET-Anfragen.</p>
        
        <label for="ngrok-url-input" class="block mb-2 text-sm font-medium">Ihre Ngrok Basis-URL (z.B. https://xxxx.ngrok-free.dev)</label>
        <input type="url" id="ngrok-url-input" class="terminal-font w-full p-2 mb-4 bg-gray-900 border border-lime-600 rounded" value="https://unwintry-strapping-winford.ngrok-free.dev/api/encryption-approval">

        <button id="test-button" class="px-4 py-2 bg-lime-600 text-gray-900 rounded-md font-semibold hover:bg-lime-500 transition duration-150">
            API-Zugriff Testen (GET)
        </button>

        <div class="mt-6">
            <h2 class="text-lg font-semibold mb-2">Ergebnis:</h2>
            <pre id="result-output" class="terminal-font whitespace-pre-wrap p-4 bg-gray-900 border border-gray-700 rounded text-sm h-40 overflow-auto">Warten auf Test...</pre>
        </div>
        
    </div>

<script>
    // Dies ist der API-Token, der im 'server.js' definiert ist und mitgesendet werden MUSS.
    const API_TOKEN = 'd9F3kL1bQ7rXp2VwZ8nM5tC4sJ6yH0uR'; 

    document.getElementById('test-button').addEventListener('click', async () => {
        const output = document.getElementById('result-output');
        const urlInput = document.getElementById('ngrok-url-input');
        const fullUrl = urlInput.value.trim();
        
        if (!fullUrl.startsWith('http')) {
            output.textContent = "FEHLER: Bitte eine gültige URL (beginnend mit http/https) eingeben.";
            return;
        }

        // NEU: Verwende die im server.js definierte Methode 'GET'.
        const requestMethod = 'GET';
        
        output.textContent = `Sende ${requestMethod}-Anfrage an ${fullUrl}...\n\n`;

        try {
            // Führen Sie den GET-Aufruf mit dem erforderlichen Token-Header durch.
            const response = await fetch(fullUrl, {
                method: requestMethod,
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Token': API_TOKEN // Senden des erforderlichen Tokens
                }
                // Bei GET wird kein 'body' gesendet.
            });

            const data = await response.json();
            
            output.textContent += `Status: ${response.status} ${response.statusText}\n`;
            output.textContent += '--------------------------------------\n';
            output.textContent += JSON.stringify(data, null, 2);

            if (response.ok && data.approval === true) {
                output.classList.remove('text-red-400');
                output.classList.add('text-lime-400');
            } else {
                output.classList.remove('text-lime-400');
                output.classList.add('text-red-400');
            }

        } catch (error) {
            output.textContent += '--------------------------------------\n';
            output.textContent += `FATALER FEHLER: ${error.message}\n`;
            output.textContent += 'Mögliche Ursachen: Ngrok-Server offline, Netzwerkproblem oder CORS-Fehler.';
            output.classList.remove('text-lime-400');
            output.classList.add('text-red-400');
        }
    });

    window.onload = () => {
        console.log("Ngrok URL wurde automatisch eingefügt. Klicken Sie auf 'API-Zugriff Testen (GET)'.");
    };

</script>
</body>
</html>
