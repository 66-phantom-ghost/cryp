<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Crypto Terminal</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        background-color: #080808;
        color: #00ff00;
        font-family: 'Fira Code', monospace;
        min-height: 100vh;
        padding: 2rem;
    }
    .terminal-card {
        background-color: #111111;
        border: 2px solid #00ff00;
        border-radius: 8px;
        padding: 2rem;
        max-width: 600px;
        margin: auto;
        box-shadow: 0 0 20px rgba(0,255,0,0.3);
    }
    input, textarea {
        background-color: #0d0d0d;
        border: 1px solid #00ff00;
        color: #00ff00;
        border-radius: 4px;
        padding: 0.5rem;
        width: 100%;
        margin-bottom: 0.5rem;
        font-family: 'Fira Code', monospace;
    }
    button {
        background-color: #00ff00;
        color: #080808;
        padding: 0.75rem;
        font-weight: bold;
        border-radius: 4px;
        width: 100%;
        margin-top: 0.5rem;
        cursor: pointer;
        transition: 0.2s;
    }
    button:hover {
        background-color: #008800;
    }
    .output-box {
        background-color: #0d0d0d;
        border: 1px solid #00ff00;
        border-radius: 4px;
        padding: 1rem;
        margin-top: 1rem;
        white-space: pre-wrap;
        word-break: break-all;
        min-height: 3rem;
    }
</style>
</head>
<body>
<div class="terminal-card">
    <h1 class="text-2xl font-bold mb-4">üîí Secure Crypto Terminal</h1>
    
    <label>Prim√§res Passwort (Pflicht):</label>
    <input type="password" id="password" placeholder="Passwort">
    
    <label>Sicherheitszusatz 1 (Optional):</label>
    <input type="password" id="extra1" placeholder="Zusatz 1">
    
    <label>Sicherheitszusatz 2 (Optional):</label>
    <input type="password" id="extra2" placeholder="Zusatz 2">
    
    <label>Sicherheitszusatz 3 (Optional):</label>
    <input type="password" id="extra3" placeholder="Zusatz 3">
    
    <label>Text zum Verschl√ºsseln / Entschl√ºsseln:</label>
    <textarea id="plaintext" rows="4" placeholder="Text hier eingeben..."></textarea>
    
    <button onclick="encryptData()">üîë Verschl√ºsseln</button>
    <button onclick="decryptData()">üîì Entschl√ºsseln</button>
    
    <div class="output-box" id="output">Hier erscheinen Ergebnisse...</div>
</div>

<script>
const HASH_ALGO = "SHA-512";
const KEY_ALGO = "AES-GCM";
const KEY_LENGTH = 256;
const ITERATIONS = 1_000_000;
const IV_BYTE_SIZE = 12;

async function deriveKey(password, extras, salt) {
    const encoder = new TextEncoder();
    const combined = password + '|' + extras.join('|');
    const baseKey = await crypto.subtle.importKey(
        "raw",
        encoder.encode(combined),
        { name: "PBKDF2" },
        false,
        ["deriveKey"]
    );
    return crypto.subtle.deriveKey(
        {
            name: "PBKDF2",
            salt: encoder.encode(salt),
            iterations: ITERATIONS,
            hash: HASH_ALGO
        },
        baseKey,
        { name: KEY_ALGO, length: KEY_LENGTH },
        false,
        ["encrypt","decrypt"]
    );
}

async function encryptData() {
    const pwd = document.getElementById("password").value;
    const extras = [
        document.getElementById("extra1").value,
        document.getElementById("extra2").value,
        document.getElementById("extra3").value
    ];
    const text = document.getElementById("plaintext").value;
    const output = document.getElementById("output");

    if (!pwd || !text) {
        output.textContent = "‚ö†Ô∏è Passwort und Text sind Pflicht!";
        return;
    }

    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv = crypto.getRandomValues(new Uint8Array(IV_BYTE_SIZE));
    const key = await deriveKey(pwd, extras, salt);

    const encrypted = await crypto.subtle.encrypt(
        { name: KEY_ALGO, iv },
        key,
        new TextEncoder().encode(text)
    );

    const result = [
        btoa(String.fromCharCode(...salt)),
        btoa(String.fromCharCode(...iv)),
        btoa(String.fromCharCode(...new Uint8Array(encrypted)))
    ].join(".");

    output.textContent = result;
}

async function decryptData() {
    const pwd = document.getElementById("password").value;
    const extras = [
        document.getElementById("extra1").value,
        document.getElementById("extra2").value,
        document.getElementById("extra3").value
    ];
    const cipherText = document.getElementById("plaintext").value;
    const output = document.getElementById("output");

    try {
        const [saltB64, ivB64, dataB64] = cipherText.split(".");
        const salt = Uint8Array.from(atob(saltB64), c=>c.charCodeAt(0));
        const iv = Uint8Array.from(atob(ivB64), c=>c.charCodeAt(0));
        const data = Uint8Array.from(atob(dataB64), c=>c.charCodeAt(0));
        const key = await deriveKey(pwd, extras, salt);

        const decrypted = await crypto.subtle.decrypt(
            { name: KEY_ALGO, iv },
            key,
            data
        );
        output.textContent = new TextDecoder().decode(decrypted);
    } catch (e) {
        output.textContent = "‚ùå Entschl√ºsselung fehlgeschlagen. Passwort oder Zus√§tze stimmen nicht.";
    }
}
</script>
</body>
</html>
