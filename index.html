<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Crypto-Gate Demo</title>
<style>
body { font-family:sans-serif; background:#1e1e2f; color:#eee; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; margin:0; }
h1 { color:#00ffdd; text-shadow:0 0 8px #00ffdd; }
textarea { width:80%; height:100px; margin:10px 0; padding:10px; border-radius:8px; border:none; resize:none; font-size:16px; background:#2a2a40; color:#fff; }
input, button { margin:5px; padding:10px; border-radius:8px; border:none; font-size:16px; }
button { background:#00ffdd; color:#1e1e2f; cursor:pointer; transition:0.2s; }
button:hover { background:#00ffaa; }
#result { width:80%; height:100px; margin-top:10px; padding:10px; border-radius:8px; background:#2a2a40; color:#fff; font-size:16px; overflow-wrap: break-word; }
</style>
</head>
<body>

<h1>Crypto-Gate Demo</h1>

<textarea id="plaintext" placeholder="Hier Text eingeben..."></textarea>
<input type="password" id="password" placeholder="Passwort / gehashtes Passwort">
<br>
<button onclick="encrypt()">ðŸ”’ VerschlÃ¼sseln</button>
<button onclick="decrypt()">ðŸ”“ EntschlÃ¼sseln</button>

<textarea id="result" placeholder="Hier erscheint der verschlÃ¼sselte / entschlÃ¼sselte String" readonly></textarea>

<script>
const SERVER_URL = 'https://unwintry-strapping-winford.ngrok-free.dev'; // dein Server

async function getChallenge() {
  const res = await fetch(`${SERVER_URL}/api/challenge`, { method:'POST' });
  if (!res.ok) throw new Error('Challenge fehlgeschlagen');
  return await res.json().then(j => j.challenge);
}

function randomNonce() {
  const arr = new Uint8Array(16);
  crypto.getRandomValues(arr);
  return Array.from(arr).map(b=>b.toString(16).padStart(2,'0')).join('');
}

async function sendCrypto(mode) {
  try {
    const challenge = await getChallenge();
    const nonce = randomNonce();
    const password = document.getElementById('password').value;
    const data = document.getElementById('plaintext').value;

    // Signatur nur Dummy, server prÃ¼ft Challenge/Nonce/Password
    const signature = '00'.repeat(32);

    const res = await fetch(`${SERVER_URL}/api/${mode}`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({challenge, nonce, password, data, signature})
    });

    if (!res.ok) {
      document.getElementById('result').value = 'Fehler: ' + res.status;
      return;
    }

    const json = await res.json();
    document.getElementById('result').value = json.result;
  } catch(err) {
    document.getElementById('result').value = 'Fehler: ' + err.message;
  }
}

function encrypt() { sendCrypto('encrypt'); }
function decrypt() { sendCrypto('decrypt'); }
</script>
</body>
</html>
