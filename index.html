<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Cyber Vault</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background: radial-gradient(circle at top, #1b1b1f, #09090c);
  color: #e6e6eb;
  font-family: system-ui, monospace;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.panel {
  background: rgba(20,20,28,.9);
  border: 1px solid #ff3355;
  box-shadow: 0 0 40px rgba(255,50,80,.2);
  padding: 20px;
  width: 420px;
  border-radius: 12px;
}

h1 {
  color: #ff4466;
  text-align: center;
  margin-bottom: 10px;
}

textarea, input {
  width: 100%;
  background: #0f0f14;
  color: #fff;
  border: 1px solid #333;
  border-radius: 6px;
  padding: 8px;
  margin-bottom: 10px;
}

button {
  width: 48%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: linear-gradient(135deg,#ff3355,#ff6688);
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

.row {
  display: flex;
  justify-content: space-between;
  gap: 4%;
}

.output {
  font-size: 12px;
  opacity: .8;
  white-space: pre-wrap;
}
</style>
</head>

<body>
<div class="panel">
  <h1>CYBER VAULT</h1>

  <input id="password" type="password" placeholder="Passwort">
  <textarea id="data" rows="4" placeholder="Text"></textarea>

  <div class="row">
    <button onclick="send('encrypt')">Verschlüsseln</button>
    <button onclick="send('decrypt')">Entschlüsseln</button>
  </div>

  <pre id="out" class="output"></pre>
</div>

<script>
const API = 'https://unwintry-strapping-winford.ngrok-free.dev';

function xhrPost(url, data, cb) {
  const xhr = new XMLHttpRequest();
  xhr.open('POST', url, true);
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.onreadystatechange = () => {
    if (xhr.readyState === 4) {
      cb(xhr.status, xhr.responseText);
    }
  };
  xhr.send(JSON.stringify(data));
}

function send(mode) {
  const password = document.getElementById('password').value;
  const data = document.getElementById('data').value;
  const out = document.getElementById('out');

  out.textContent = '⏳ Anfrage läuft…';

  // 1️⃣ Challenge holen
  xhrPost(API + '/api/challenge', {}, (s1, r1) => {
    if (s1 !== 200) {
      out.textContent = '❌ Challenge fehlgeschlagen';
      return;
    }

    const { challenge, nonce } = JSON.parse(r1);

    // 2️⃣ Crypto-Request
    xhrPost(API + '/api/crypto', {
      mode,
      challenge,
      nonce,
      password,
      data
    }, (s2, r2) => {
      if (s2 !== 200) {
        out.textContent = '❌ Server verweigert';
        return;
      }

      out.textContent = r2;
    });
  });
}
</script>
</body>
</html>
