<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cyber-Anime Crypto</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#1a1a2e,#162447);
    color: #e0e0e0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  .container {
    background: rgba(20,20,40,0.9);
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 0 30px #0f0f3f;
    width: 100%;
    max-width: 500px;
  }
  h1 { text-align: center; color: #00ffe4; }
  input, textarea, button {
    width: 100%;
    margin-top: 0.5rem;
    padding: 0.7rem;
    border-radius: 8px;
    border: none;
    outline: none;
    font-size: 1rem;
  }
  button {
    cursor: pointer;
    background: #00ffe4;
    color: #162447;
    font-weight: bold;
    transition: 0.2s;
  }
  button:hover {
    background: #00c8b0;
  }
  textarea {
    resize: vertical;
  }
  .result {
    margin-top: 1rem;
    word-break: break-all;
    background: #0f0f3f;
    padding: 0.7rem;
    border-radius: 8px;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Cyber-Anime Crypto</h1>
  <input type="password" id="password" placeholder="Passwort">
  <textarea id="plaintext" rows="5" placeholder="Text hier eingeben"></textarea>
  <button id="encryptBtn">Verschlüsseln</button>
  <button id="decryptBtn">Entschlüsseln</button>
  <div class="result" id="result"></div>
</div>

<script>
const SERVER_URL = 'https://unwintry-strapping-winford.ngrok-free.dev';

async function getChallenge() {
  const resp = await fetch(SERVER_URL + '/api/challenge', { method: 'POST' });
  if (!resp.ok) throw new Error('Challenge fehlgeschlagen');
  const data = await resp.json();
  return data.challenge;
}

function randomHex(len=32) {
  const arr = new Uint8Array(len);
  crypto.getRandomValues(arr);
  return Array.from(arr).map(b => b.toString(16).padStart(2,'0')).join('');
}

async function sendCrypto(mode) {
  const challenge = await getChallenge();
  const nonce = randomHex(16);
  const password = document.getElementById('password').value;
  const data = document.getElementById('plaintext').value;

  const payloadHash = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(JSON.stringify({ challenge, nonce, mode })));
  const sigHex = Array.from(new Uint8Array(payloadHash)).map(b => b.toString(16).padStart(2,'0')).join('');

  const resp = await fetch(SERVER_URL + '/api/' + mode, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ challenge, nonce, password, data, signature: sigHex })
  });

  if (!resp.ok) {
    document.getElementById('result').innerText = 'Fehler beim ' + mode;
    return;
  }

  const resultData = await resp.json();
  document.getElementById('result').innerText = resultData.result;
}

document.getElementById('encryptBtn').addEventListener('click', () => sendCrypto('encrypt'));
document.getElementById('decryptBtn').addEventListener('click', () => sendCrypto('decrypt'));
</script>
</body>
</html>
