<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Crypto‑Gate</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#000;
  --card:#0a0a0a;
  --panel:#0f0f0f;
  --red:#ff073a;
  --green:#00ff41;
  --text:#e5e7eb;
  --muted:#777;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle,#1a0000,#000 70%);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Inter,system-ui,Arial,sans-serif;
  color:var(--text);
}

.card{
  width:100%;
  max-width:460px;
  background:var(--card);
  padding:28px;
  border-radius:18px;
  box-shadow:0 0 40px rgba(255,0,0,.35);
}

h1{
  text-align:center;
  color:var(--red);
  letter-spacing:1px;
  margin-bottom:6px;
}

p{
  text-align:center;
  font-size:.85rem;
  color:var(--muted);
  margin-bottom:20px;
}

label{
  font-size:.75rem;
  color:var(--muted);
}

input,textarea{
  width:100%;
  background:var(--panel);
  border:none;
  border-radius:10px;
  padding:14px;
  color:var(--text);
  margin:6px 0 16px;
  outline:none;
}

textarea{min-height:90px}

.actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

button{
  border:none;
  border-radius:12px;
  padding:14px;
  font-weight:700;
  cursor:pointer;
}

.encrypt{
  background:linear-gradient(135deg,#ff073a,#b8002a);
  color:white;
}

.decrypt{
  background:linear-gradient(135deg,#00ff41,#00b82f);
  color:black;
}

.output{
  margin-top:18px;
  background:#020202;
  border-radius:12px;
  padding:14px;
  font-family:monospace;
  word-break:break-all;
  min-height:50px;
}

.meta{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:.75rem;
  margin-top:8px;
}

.copy{
  background:none;
  border:1px solid var(--green);
  color:var(--green);
  padding:6px 10px;
  border-radius:8px;
  cursor:pointer;
  display:none;
}
</style>
</head>
<body>

<div class="card">
  <h1>Crypto‑Gate</h1>
  <p>Private · Secure · Minimal</p>

  <label>Passwort</label>
  <input id="pw" type="password">

  <label>Text</label>
  <textarea id="txt"></textarea>

  <div class="actions">
    <button class="encrypt" id="encBtn">Verschlüsseln</button>
    <button class="decrypt" id="decBtn">Entschlüsseln</button>
  </div>

  <div class="output" id="out">Bereit.</div>

  <div class="meta">
    <span id="info"></span>
    <button class="copy" id="copyBtn">Kopieren</button>
  </div>
</div>

<script>
const API = "https://unwintry-strapping-winford.ngrok-free.dev";

const pw  = document.getElementById("pw");
const txt = document.getElementById("txt");
const out = document.getElementById("out");
const info = document.getElementById("info");
const copyBtn = document.getElementById("copyBtn");

let fullResult = "";

function short(s){
  return s.length > 60 ? s.slice(0,30)+"…"+s.slice(-20) : s;
}

async function cryptoRun(mode){
  if(!pw.value || !txt.value){
    out.textContent = "Passwort und Text fehlen.";
    return;
  }

  out.textContent = "Arbeite…";
  copyBtn.style.display="none";

  try{
    const chRes = await fetch(API+"/api/challenge",{method:"POST"});
    const ch = await chRes.json();

    const res = await fetch(API+"/api/"+mode,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        password: pw.value,
        data: txt.value,
        challenge: ch.challenge,
        nonce: ch.nonce,
        signature: ch.signature
      })
    });

    const data = await res.json();

    if(!data.result){
      out.textContent = data.error || "Fehler";
      return;
    }

    fullResult = data.result;
    out.textContent = short(fullResult);
    info.textContent = fullResult.length + " Zeichen";
    copyBtn.style.display="inline-block";

  }catch{
    out.textContent = "Server nicht erreichbar.";
  }
}

document.getElementById("encBtn").onclick = ()=>cryptoRun("encrypt");
document.getElementById("decBtn").onclick = ()=>cryptoRun("decrypt");

copyBtn.onclick = ()=>{
  navigator.clipboard.writeText(fullResult);
  info.textContent = "Kopiert";
};
</script>

</body>
</html>
