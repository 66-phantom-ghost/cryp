<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini Messenger</title>
<style>
  body {
    background-color: #121212;
    color: #f0f0f0;
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 600px;
    margin: auto;
  }

  h2 { color: #ff3b3b; }

  #chat {
    border: 1px solid #ff3b3b;
    padding: 10px;
    height: 300px;
    overflow-y: auto;
    margin-bottom: 10px;
    background-color: #1e1e1e;
  }

  input, button {
    padding: 8px;
    margin: 2px;
    border-radius: 4px;
    border: none;
  }

  input {
    background-color: #1e1e1e;
    color: #f0f0f0;
  }

  button {
    background-color: #ff3b3b;
    color: #fff;
    cursor: pointer;
  }

  button:hover {
    background-color: #ff1a1a;
  }

  .system {
    color: #ff3b3b;
    font-style: italic;
  }
</style>
</head>
<body>

<h2>Mini Messenger</h2>

<div>
  <label>Deine User-ID: <input type="text" id="userId" placeholder="z.B. user1"></label>
  <button id="connectBtn">Verbinden</button>
</div>

<div id="chat"></div>

<div>
  <input type="text" id="toId" placeholder="Empfänger-ID">
  <input type="text" id="message" placeholder="Nachricht">
  <button id="sendBtn">Senden</button>
</div>

<script>
let ws;

function logMessage(sender, text, isSystem=false) {
  const chat = document.getElementById('chat');
  const msgDiv = document.createElement('div');
  msgDiv.textContent = `${sender}: ${text}`;
  if(isSystem) msgDiv.classList.add('system');
  chat.appendChild(msgDiv);
  chat.scrollTop = chat.scrollHeight;
}

document.getElementById('connectBtn').onclick = () => {
  const userId = document.getElementById('userId').value.trim();
  if(!userId) return logMessage('System', 'Bitte gib deine User-ID ein!', true);

  ws = new WebSocket('wss://unwintry-strapping-winford.ngrok-free.dev');

  ws.onopen = () => {
    logMessage('System', 'Verbunden!', true);
    ws.send(JSON.stringify({ type: 'register', userId }));
  };

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    logMessage(data.from || 'Server', data.text);
  };

  ws.onclose = () => logMessage('System', 'Verbindung geschlossen', true);
};

document.getElementById('sendBtn').onclick = () => {
  const to = document.getElementById('toId').value.trim();
  const text = document.getElementById('message').value.trim();

  if(!ws || ws.readyState !== WebSocket.OPEN) {
    return logMessage('System', 'Bitte zuerst verbinden!', true);
  }

  if(!to) return logMessage('System', 'Empfänger-ID fehlt!', true);
  if(!text) return logMessage('System', 'Nachricht darf nicht leer sein!', true);

  ws.send(JSON.stringify({ type: 'message', to, text }));
  logMessage('Du → ' + to, text);
  document.getElementById('message').value = '';
};
</script>

</body>
</html>
