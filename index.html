<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto-Gate</title>
<style>
:root {
  --bg: #000;
  --card: #0a0a0a;
  --panel: #0d0d00;
  --accent: #FF073A;
  --accent2: #00FF41;
  --text: #e5e7eb;
  --muted: #888;
  --border: rgba(255,255,255,0.08);
}
body {
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle,#1a0000 0%,#000 80%);
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
  color:var(--text);
}
.card {
  background: var(--card);
  padding:30px;
  border-radius:16px;
  box-shadow:0 0 50px var(--accent);
  max-width:480px;
  width:90%;
}
header {text-align:center;margin-bottom:20px;}
header h1 {color:var(--accent);margin:0;font-size:2rem;}
header p {color:var(--muted);margin:4px 0 0;}
label {display:block;margin-bottom:6px;color:var(--muted);}
input, textarea {
  width:100%;
  padding:12px;
  margin-bottom:16px;
  border-radius:10px;
  border:none;
  background:var(--panel);
  color:var(--text);
  font-size:1rem;
  outline:none;
  box-shadow: inset 0 0 0 1px var(--border);
}
input:focus, textarea:focus {box-shadow:0 0 0 2px var(--accent), inset 0 0 0 1px var(--accent);}
textarea {resize:vertical; min-height:80px;}
.actions {display:flex; gap:12px; margin-bottom:20px;}
button {
  flex:1;
  padding:12px;
  font-weight:700;
  border:none;
  border-radius:10px;
  cursor:pointer;
  transition: all 0.2s ease;
}
button:hover {transform:translateY(-2px);}
.encrypt {background: linear-gradient(135deg,var(--accent),#C0042D); color:white;}
.decrypt {background: linear-gradient(135deg,var(--accent2),#00C834); color:#0a0a0a;}
.output {
  background:var(--panel);
  padding:12px;
  border-radius:10px;
  font-family: monospace;
  word-break:break-all;
  margin-bottom:8px;
  border:1px solid var(--border);
  color:#00FFFF;
}
.copy {background:transparent;border:1px solid var(--accent2);padding:6px 10px;border-radius:8px;color:var(--accent2);cursor:pointer;}
.copy:hover {background: rgba(0,255,65,0.1); box-shadow:0 0 8px rgba(0,255,65,0.4);}
</style>
</head>
<body>
<div class="card">
  <header>
    <h1>Crypto-Gate</h1>
    <p>Private · Minimal · Secure</p>
  </header>

  <label for="password">Passwort</label>
  <input id="password" type="password" placeholder="••••••••">

  <label for="text">Text</label>
  <textarea id="text" placeholder="Klartext oder verschlüsselter Inhalt"></textarea>

  <div class="actions">
    <button class="encrypt" onclick="run('encrypt')">Verschlüsseln</button>
    <button class="decrypt" onclick="run('decrypt')">Entschlüsseln</button>
  </div>

  <div class="output" id="preview">Bereit.</div>
  <button class="copy" onclick="copy()" id="copyBtn" style="display:none">Kopieren</button>
  <p id="info"></p>
</div>

<script>
const API_BASE = "https://unwintry-strapping-winford.ngrok-free.dev";
let challenge = null;
let challengeId = null;
let fullResult = "";

// Holt die Challenge beim Laden
async function fetchChallenge() {
  try {
    const res = await fetch(`${API_BASE}/api/challenge`, {method:"POST"});
    const json = await res.json();
    challenge = json.challenge;
    challengeId = json.challengeId;
  } catch(e) {
    console.error("Challenge konnte nicht geladen werden", e);
    challenge = null;
    challengeId = null;
  }
}

// Initiale Challenge holen
fetchChallenge();

async function run(mode) {
  const pw = document.getElementById("password").value.trim();
  const tx = document.getElementById("text").value.trim();
  const preview = document.getElementById("preview");
  const info = document.getElementById("info");
  const copyBtn = document.getElementById("copyBtn");

  if(!pw || !tx) {
    preview.textContent = "Passwort und Text eingeben.";
    copyBtn.style.display="none";
    info.textContent="";
    return;
  }

  if(!challengeId) {
    preview.textContent="Fehler: Challenge nicht geladen.";
    copyBtn.style.display="none";
    return;
  }

  preview.textContent="Verarbeite…";
  copyBtn.style.display="none";
  info.textContent="";

  try {
    const res = await fetch(`${API_BASE}/api/${mode}`, {
      method:"POST",
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({password:pw, data:tx, challengeId})
    });
    if(res.status === 429) {
      preview.textContent="Zu viele Anfragen! Bitte warten.";
      return;
    }
    if(res.status >=400) {
      preview.textContent=`Fehler: Server antwortete mit ${res.status}`;
      return;
    }
    const json = await res.json();
    fullResult = json.result || "";
    preview.textContent = fullResult.length>50 ? fullResult.slice(0,25)+'…'+fullResult.slice(-25) : fullResult;
    info.textContent = fullResult.length + " Zeichen";
    copyBtn.style.display="inline-block";
  } catch(e) {
    preview.textContent="Server nicht erreichbar.";
    console.error(e);
  }
}

function copy() {
  if(fullResult) {
    navigator.clipboard.writeText(fullResult);
    document.getElementById("info").textContent="Kopiert!";
  }
}
</script>
</body>
</html>
